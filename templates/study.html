{% extends "base.html" %}
{% block content %}
<section class="space-y-4">
  <h2 class="text-xl font-semibold">Study — Sliding Puzzle (Step 2)</h2>
  <p class="text-sm text-gray-600">Solve the 4×4 puzzle. After you solve it, you may need to wait a few seconds to meet the minimum play time.</p>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="md:col-span-2 bg-white rounded-xl shadow p-4">
      <canvas id="puzzle" width="400" height="400" class="w-full h-auto rounded-lg border"></canvas>

      <div class="mt-3 flex items-center gap-4">
        <button id="startBtn" class="px-3 py-2 rounded-lg bg-black text-white">Start level</button>
        <button id="submitBtn" class="px-3 py-2 rounded-lg bg-indigo-600 text-white" disabled>Submit result</button>
        <button id="quitBtn" class="px-3 py-2 rounded-lg bg-gray-300 text-gray-900" disabled>Quit level</button>
        <span id="message" class="text-sm text-gray-700" aria-live="polite"></span>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow p-4">
      <div class="space-y-2">
        <div class="text-sm text-gray-500">Progress</div>
        <div id="levelLabel" class="font-medium">Level</div>
        <div id="difficultyLabel" class="text-sm text-gray-600">difficulty</div>
      </div>
      <div class="mt-4 grid grid-cols-2 gap-4">
        <div>
          <div class="text-sm text-gray-500">Timer</div>
          <div id="timer" class="text-2xl font-semibold">0:00</div>
        </div>
        <div>
          <div class="text-sm text-gray-500">Moves</div>
          <div id="moves" class="text-2xl font-semibold">0</div>
        </div>
      </div>
      <div id="completionNote" class="hidden mt-4 text-sm text-green-700">
        Great! All puzzle rounds are complete. Step 3 will add the TLX questionnaires here.
      </div>
    </div>
  </div>

  <div id="tlxModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-3xl p-6">
      <h2 id="tlxTitle" class="text-xl font-semibold mb-4">NASA-TLX</h2>

      <form id="tlxSliderForm" class="space-y-4 hidden">
        <p class="text-sm text-gray-600">Rate each dimension from 1 (very low) to 7 (very high).</p>
        <div id="tlxSliderFields" class="space-y-3"></div>
        <div class="mt-4 flex items-center gap-3">
          <button type="button" id="tlxSubmitSlider" class="px-4 py-2 rounded-lg bg-indigo-600 text-white">Submit</button>
          <span id="tlxMsg" class="text-sm text-gray-700" aria-live="polite"></span>
        </div>
      </form>

      <form id="tlxDescForm" class="space-y-4 hidden">
        <p class="text-sm text-gray-600">Write 1–2 simple sentences for each dimension (minimum will be enforced if needed).</p>
        <div id="tlxDescFields" class="space-y-3"></div>
        <div class="mt-4 flex items-center gap-3">
          <button type="button" id="tlxSubmitDesc" class="px-4 py-2 rounded-lg bg-indigo-600 text-white">Submit</button>
          <span id="tlxMsgDesc" class="text-sm text-gray-700" aria-live="polite"></span>
        </div>
      </form>

      <div id="tlxBusy" class="mt-4 hidden items-center gap-2 text-gray-700">
        <span class="inline-block w-5 h-5 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"></span>
        <span>Submitting and validating your answers… please wait.</span>
      </div>
    </div>
  </div>

  <script>
  window.TLX_DIMS = ["Mental Demand","Physical Demand","Temporal Demand","Performance","Effort","Frustration"];
  window.TLX_QUESTIONS = {
    "Mental Demand":      "How mentally demanding was the task?",
    "Physical Demand":    "How physically demanding was the task?",
    "Temporal Demand":    "How hurried or rushed was the pace of the task?",
    "Performance":        "How successful were you in accomplishing what you were asked to do?",
    "Effort":             "How hard did you have to work to accomplish your level of performance?",
    "Frustration":        "How insecure, discouraged, irritated, stressed, or annoyed were you?"
  };

  (function(){
    const holder = document.getElementById('tlxSliderFields');
    if (holder) {
      TLX_DIMS.forEach(dim => {
        const id = 'tlx_'+dim.replace(/\s+/g,'_');
        const prompt = window.TLX_QUESTIONS[dim] || '';
        const wrap = document.createElement('div');
        wrap.innerHTML = `
          <label for="${id}" class="block text-sm font-medium text-gray-900">${dim}</label>
          <p class="text-xs text-gray-600 mb-1">${prompt}</p>
          <input type="range" min="1" max="7" value="4" step="1" id="${id}" class="w-full" />
          <div class="flex justify-between text-xs text-gray-500">
            <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
          </div>`;
        holder.appendChild(wrap);
      });
    }

    const holderD = document.getElementById('tlxDescFields');
    if (holderD) {
      TLX_DIMS.forEach(dim => {
        const id = 'tlx_text_'+dim.replace(/\s+/g,'_');
        const prompt = window.TLX_QUESTIONS[dim] || '';
        const wrap = document.createElement('div');
        wrap.innerHTML = `
          <label for="${id}" class="block text-sm font-medium text-gray-900">${dim}</label>
          <p class="text-xs text-gray-600 mb-1">${prompt}</p>
          <textarea id="${id}" rows="2" class="w-full rounded border border-gray-300 p-2" placeholder="A sentence or two about this round..."></textarea>`;
        holderD.appendChild(wrap);
      });
    }
  })();
</script>

<script src="/static/js/game.js?v=tlx8"></script>

</section>
{% endblock %}
